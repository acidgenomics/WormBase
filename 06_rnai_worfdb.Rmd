---
title: "WORFDB annotations"
date: "`r BiocStyle::doc_date()`"
---

```{r setup, message=FALSE}
source("setup.R")
```

```{r header, child="_header.Rmd"}
```



```{r load}
loadData(
    geneIDs,
    worfdbHTML,
    worfdbHTMLRemap,
    dir = dataDir)
```

```{r worfdb}
worfdb1 <- worfdbData(worfdbHTML)
# FIXME R153.1f
worfdb2 <- worfdbData(worfdbHTMLRemap)
# FIXME all NA row?
# FIXME 30037G9, 30040G2
worfdb <- bind_rows(worfdb1, worfdb2) %>%
    filter(is.na(remap)) %>%
    select(-c(query, remap)) %>%
    distinct() %>%
    arrange(clone) %>%
    left_join(geneIDs[, c("gene", "sequence")], by = "sequence")
saveData(
    worfdb1,
    worfdb2,
    worfdb,
    dir = dataDir,
    compress = compress)
```

Check for unmatched clones:

```{r unmatched}
worfdb %>%
    filter(is.na(gene)) %>%
    glimpse()
```

Check for duplicate sequences:

```{r dupes}
dupes <- worfdb %>%
    group_by(clone) %>%
    filter(n() > 1) %>%
    select(clone, everything())
glimpse(dupes)
```



```{r footer, child="_footer.Rmd"}
```
