---
title: "ORFeome RNAi library annotations"
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = normalizePath("../"))
```

```{r, include=FALSE}
source("data-raw/setup.R")
```

# ORFeome Library

Use the annotation data from [GE Dharmacon](http://dharmacon.gelifesciences.com/non-mammalian-cdna-and-orf/c.-elegans-rnai/):

## Convert the `orfeome.xlsx` source file

```{r orfeome}
if (!file.exists("data-raw/orfeome.xlsx")) {
  download.file("http://dharmacon.gelifesciences.com/uploadedFiles/Resources/cernai-feeding-library.xlsx",
                "data-raw/orfeome.xlsx")
}
df <- readxl::read_excel("data-raw/orfeome.xlsx", sheet = 2)

colnames(df) <- seqcloudr::camel(colnames(df))
names(df)[names(df) == "orfIdWs112"] <- "orf"
names(df)[names(df) == "rnaiWell"] <- "orfeomeHistorical"

# Remove empty ORFs
df$orf <- gsub("^no match in WS112", NA, df$orf)
df <- subset(df, !is.na(orf))

# Select the desired columns, rename, then subset the bad wells:
df <- df[, c("orf", "plate", "row", "col", "orfeomeHistorical")]

# Set plate IDs as rownames
df$orfeome <- do.call(paste, c(df[, c("plate", "row", "col")], sep = "-"))
df$orfeome[1]
df$orfeome <- gsub("^(.*)-([0-9]{1})$", "\\1-0\\2", df$orfeome) # pad zeros
df$orfeome[1]
df$orfeome <- gsub("^([0-9]{5})-([A-Z]{1})-([0-9]{2})$", "\\1@\\2\\3", df$orfeome)
df$orfeome[1]

df$oligo <- paste0("mv_", df$orf)
df$rnaiHistorical <- paste0("MV_SV:mv_", df$orf)

orfeomeData <- df
devtools::use_data(orfeomeData, overwrite = TRUE)
```
