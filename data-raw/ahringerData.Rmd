---
title: "Ahringer RNAi library annotations"
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = normalizePath("../"))
```

```{r, include=FALSE}
source("data-raw/setup.R")
```

Use the annotation data from [Source Bioscience](http://www.us.lifesciences.sourcebioscience.com/clone-products/non-mammalian/c-elegans/c-elegans-rnai-library/):

Up-to-date mapping of Julie Ahringer RNAi library clones to current WormBase gene models:
ftp://caltech.wormbase.org/pub/annots/rnai/

```{r ahringer}
ahringer <- list()
if (!file.exists("data-raw/ahringer.xlsx")) {
download.file("http://www.us.lifesciences.sourcebioscience.com/media/381254/C.%20elegans%20Database%202012.xlsx",
              "data-raw/ahringer.xlsx")
}

chromosomes <- c("I", "II", "III", "IV", "V", "X")
for (i in 1:length(chromosomes)) {
  df <- readxl::read_excel("data-raw/ahringer.xlsx", sheet = i + 1)  # First sheet contains notes
  
  colnames(df) <- seqcloudr::camel(colnames(df))
  df$extraInfo <- NULL
  names(df)[names(df) == "genePairsName"] <- "genePair"
  names(df)[names(df) == "sourceBioscienceLocation"] <- "sourceBioscience384"
  
  #! df$plate <- stringr::str_pad(df$plate, 3, pad = "0")
  df$ahringer96 <- do.call(paste, c(df[, c("chrom", "plate", "well")], sep = "-"))
  df$ahringer96[1]
  df$ahringer96 <- gsub("-([A-Z]{1}[0-9]{2})$", "@\\1", df$ahringer96)
  df$ahringer96[1]
  
  df$oligo <- paste0("sjj_", df$genePair)
  df$rnaiHistorical <- paste0("JA:", df$genePair)
  
  name <- paste0("chr", chromosomes[i])
  assign(name, df)
}
rm(df, i)
list <- list(chrI, chrII, chrIII, chrIV, chrV, chrX)
df <- data.frame(do.call("rbind", list))

ahringerData <- df
devtools::use_data(ahringerData, overwrite = TRUE)
```
